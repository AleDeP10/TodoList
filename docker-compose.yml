services:
# ──────────────────────────────────────────────
# 🗄️ PostgreSQL Database Service
# ──────────────────────────────────────────────
  todolist-db:
    # Automatically restart unless manually stopped
    restart: unless-stopped
    # Build from local db-backup folder
    build:
      context: ./db-backup
    # Name of the container
    container_name: todolist-db
    # Map host port 5433 to container port 5432
    ports:
      - 5433:5432
    # Persist database data across restarts
    volumes:
      - dbdata:/var/lib/postgresql/data
    # Connect to shared internal network
    networks:
      - todolist-net

# ──────────────────────────────────────────────
# 🧠 Backend API (ASP.NET Core)
# ──────────────────────────────────────────────
  todolist-be-csharp:
    restart: unless-stopped
    build:
      context: ./backend-csharp
    container_name: todolist-be-csharp
    ports:
      - 5001:5000
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
    networks:
      - todolist-net

# ──────────────────────────────────────────────
# 🖥️ Legacy Frontend (AngularJS)
# ──────────────────────────────────────────────
  todolist-fe-angularjs:
    restart: unless-stopped
    build:
      context: ./frontend-angularjs
      dockerfile: Dockerfile.Docker
      args:
        ENV: docker
    container_name: todolist-fe-angularjs
    ports:
      - 8081:8080
    depends_on:
      - todolist-be-csharp
    environment:
      - NGINX_ENV=docker
    networks:
      - todolist-net

# ──────────────────────────────────────────────
# ⚛️ Modern Frontend (Next.js)
# ──────────────────────────────────────────────
  todolist-fe-nextjs:
    restart: unless-stopped
    build:
      context: ./todolist-fe-nextjs
      dockerfile: Dockerfile.Docker
    container_name: todolist-fe-nextjs
    ports:
      - 444:443
    depends_on:
      - todolist-be-csharp
    networks:
      - todolist-net

# ──────────────────────────────────────────────
# 📘 Storybook Visual Testing
# ──────────────────────────────────────────────
  todolist-storybook:
    restart: unless-stopped
    build:
      context: ./todolist-storybook
      dockerfile: Dockerfile
      target: storybook
    container_name: todolist-storybook
    ports:
      - 6007:6006
    environment:
      - NODE_ENV=development
    networks:
      - todolist-net

# ──────────────────────────────────────────────
# 📦 Persistent Volume for PostgreSQL
# ──────────────────────────────────────────────
volumes:
  dbdata:

# ──────────────────────────────────────────────
# 🌐 Shared Internal Network for Service Discovery
# ──────────────────────────────────────────────
networks:
  todolist-net:
